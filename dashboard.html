<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - SineDay</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to main content</a>

  <div id="notifications" class="notifications" role="status" aria-live="polite" aria-atomic="true"></div>


  <main id="main-content">
    <div id="app">
    <div id="loading" class="loading" role="status" aria-live="polite" aria-atomic="true" style="display:none;">
      Loading...
    </div>
    <!-- Dashboard Section -->
    <section id="dashboard-section" style="display: none;">
      <header class="dash-head" role="banner">
        <div class="dash-head__top">
          <div class="dash-head__title-row">
            <h1 class="dash-head__title">SineDay</h1>
            <span id="plan-pill" class="pill pill--ok" aria-live="polite">
              <span class="pill-dot"></span>
              Premium
            </span>
          </div>
          <button id="account-toggle" class="dash-head__icon-btn" type="button"
            aria-expanded="false" aria-controls="account-sheet"
            aria-label="Account options">⋯</button>
        </div>
      </header>

      <!-- Account bottom sheet (iOS-style) -->
      <div id="account-backdrop" class="sheet-backdrop" hidden></div>

      <section id="account-sheet" class="sheet" hidden role="dialog" aria-modal="true" aria-label="Account">
        <div class="sheet__handle" aria-hidden="true"></div>

        <div class="sheet__content">
          <div class="account-email">
            <span class="muted">Signed in</span>
            <span id="signed-in-email"></span>
          </div>

          <div class="account-actions">
            <button id="upgrade-btn" class="btn btn-ghost btn-sm" type="button" style="display:none;">Upgrade</button>
            <button id="billing-btn" class="btn btn-ghost btn-sm" type="button" style="display:none;">Manage Billing</button>
            <button id="signout-btn" class="btn btn-ghost btn-sm" type="button">Sign Out</button>
          </div>

          <div id="subscription-mini" class="subscription-mini">
            <div class="subscription-mini__row">
              <span class="muted">Renewal</span>
              <span id="renewal-date">—</span>
            </div>
          </div>

          <a class="dash-home" href="/">← Home</a>
        </div>
      </section>

      <!-- Profiles Section -->
      <div class="container">
        <!-- Origin Duck Carousel -->
        <div id="duck-carousel-wrap" class="duck-carousel-wrap">
          <div class="duck-carousel-header">
            <div>
              <h2 class="duck-carousel-title">Your Origin Ducks</h2>
              <p class="text-muted duck-carousel-subtitle">
                Each profile's origin duck and current SineDay wave position.
              </p>
            </div>
          </div>
          <!-- Carousel renders here via JS -->
        </div>

        <div id="profile-limit-message">
          <strong>Profile limit reached!</strong> You can have a maximum of 10 profiles.
        </div>

        <!-- Compact control row under the carousel -->
        <div class="profiles-controls" role="group" aria-label="Profile controls">
          <button
            id="add-profile-toggle"
            class="btn btn-primary btn-sm"
            type="button"
            aria-expanded="false"
            aria-controls="add-profile-panel"
          >
            + Add Profile
          </button>

          <details class="profiles-details profiles-details--inline">
            <summary>Manage profiles (list)</summary>
            <p class="text-muted" style="margin: 10px 0 0;">
              Manage up to 10 profiles for yourself or others.
            </p>
            <div id="profiles-list"></div>
          </details>
        </div>

        <!-- Add Profile bottom sheet (iOS-style) -->
        <div id="add-profile-sheet" class="add-profile-sheet" aria-hidden="true">
          <div class="add-profile-sheet__backdrop" data-close="add-profile-sheet"></div>
          <div id="add-profile-panel" class="add-profile-sheet__panel" role="dialog" aria-modal="true" aria-labelledby="add-profile-title">
            <div class="add-profile-sheet__inner">
              <h3 id="add-profile-title">Add New Profile</h3>
              <form id="add-profile-form">
                <div class="form-group">
                  <label for="profile-name">Name</label>
                  <input type="text" id="profile-name" placeholder="John Doe" required>
                </div>

                <div class="form-group">
                  <label for="profile-birthdate">Birthdate</label>
                  <input type="date" id="profile-birthdate" required>
                </div>

                <div class="form-group">
                  <label for="profile-timezone">Timezone</label>
                  <select id="profile-timezone">
                    <option value="America/Chicago">America/Chicago (Central)</option>
                    <option value="America/New_York">America/New_York (Eastern)</option>
                    <option value="America/Los_Angeles">America/Los_Angeles (Pacific)</option>
                    <option value="America/Denver">America/Denver (Mountain)</option>
                    <option value="Europe/London">Europe/London</option>
                    <option value="Europe/Paris">Europe/Paris</option>
                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                    <option value="Asia/Shanghai">Asia/Shanghai</option>
                    <option value="Australia/Sydney">Australia/Sydney</option>
                  </select>
                </div>

                <button type="submit" id="add-profile-btn" class="btn btn-primary">Add Profile</button>
                <button id="add-profile-cancel" class="btn btn-ghost" type="button">
                  Cancel
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendars Section (Gated) -->
      <div class="container">
        <h2>Your Calendars</h2>
        <div id="calendars-section"></div>
      </div>
    </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <a href="/accessibility.html">Accessibility</a>
  </footer>

  <!-- Load Supabase from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Load our modules -->
  <script type="module" src="/js/supabase-client.js"></script>
  <script type="module" src="/js/dashboard.js"></script>
</body>
</html>
